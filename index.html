<html>
<head>
	<title>uitest</title>
	<script src="../jquery-1.11.1.js"></script>
	<link rel="stylesheet" href="styles.css"/>
</head>
<body>
	<div class="controls">
		<ul>
			<li class="function"><p>y=<span class="editor">2x</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+1</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+2</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+3</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+4</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+5</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+6</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+7</span></p></li>
			<li class="function"><p>y=<span class="editor">3x+8</span></p></li>
		</ul>
		<div class="edit">
			<div class="clearfix">
				<div class="button go">Go!</div>
				<div class="button slide">Show functions</div>
			</div>
			<div class="gallery clearfix">
				<div class="gallery-item"><p>sin</p></div>
				<div class="gallery-item"><p>cos</p></div>
				<div class="gallery-item"><p>tan</p></div>
				<div class="gallery-item"><p>pow</p></div>
			</div>
		</div>
	</div>
	<div><canvas id="graph"></canvas></div>
	<script src="http://anton.kroko.ru/builder/unstable/core.js"></script>
	<script>
	$(document).ready(function(){		
		var galleryShown = false;
		$(".controls .edit .gallery").hide();
		
		$(".controls").on("click", ".function:not(.current)", function(){
			var curFunc = $(this).closest(".function"); // curretnly equals to $(this)
			var hidden = '<div class="hidden"></div>';
			// workaround strange obj.prevAll().wrapAll() behaviuor (reverse order)
			function _prevAll(obj){
				var first = obj.siblings().addBack().first().not(obj);
				return first.nextUntil(obj).add(first);
			}
			_prevAll(curFunc).wrapAll(hidden);
			curFunc.nextAll().wrapAll(hidden);
			curFunc.closest(".controls")
				.find(".edit")
					.slideDown()
				.end()
				.find(".hidden")
					.slideUp()
				.end();
			curFunc.addClass("current");
			curFunc.find(".editor").prop("contenteditable", "true").focus();
		});
		$(".controls .edit .button")
			.filter(".slide")
				.click(function(){
					$(this).closest(".edit").find(".gallery").slideToggle();
					galleryShown = !galleryShown;
					$(this).text((galleryShown?"Hide":"Show") + " functions");
				})
			.end()
			.filter(".go")
				.click(function(){
					$(this).closest(".controls")
						.find(".hidden")
							.slideDown(function(){
								$(this).children().unwrap();
							})
						.end()
						.find(".current")
							.removeClass("current")
							.find(".editor")
								.prop("contenteditable", "false")
							.end()
						.end()
						.find(".edit")
							.slideUp()
						.end();
				})
			.end();
		
		var graph = $("#graph");
		graph.width(graph.parent().width());
		var canvas = new Canvas();
		canvas.attachCanvas("graph");
		canvas.resize();
		canvas.addFunction().setExpression('x'); //.setColor("#000000").toggleEnabled(true);
	});
	</script>
</body>
</html>
